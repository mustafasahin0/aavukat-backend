files:
  "/etc/systemd/system/nodejs-app.service":
    mode: "000644"
    owner: root
    group: root
    content: |
      [Unit]
      Description=Node.js Application
      After=network.target

      [Service]
      WorkingDirectory=/var/app/current
      ExecStart=/usr/bin/node /var/app/current/dist/index.js
      Restart=always
      RestartSec=10
      StandardOutput=syslog
      StandardError=syslog
      SyslogIdentifier=nodejs-app
      User=webapp
      Group=webapp
      Environment=NODE_ENV=production
      Environment=PORT=8000

      [Install]
      WantedBy=multi-user.target

container_commands:
  01_enable_service:
    command: |
      systemctl daemon-reload
      systemctl enable nodejs-app.service
      systemctl start nodejs-app.service || true 