commands:
  01_install_dependencies:
    command: |
      #!/bin/bash
      set -e
      cd /var/app/staging
      echo "Current directory: $(pwd)"
      echo "Directory contents: $(ls -la)"
      echo "Node version: $(node -v)"
      echo "NPM version: $(npm -v)"
      
      # Check if package.json exists
      if [ ! -f "package.json" ]; then
        echo "ERROR: package.json not found!"
        exit 1
      fi
      
      echo "Installing production dependencies..."
      npm install --production --no-optional --loglevel=verbose || {
        echo "Failed to install production dependencies"
        cat npm-debug.log || echo "No npm-debug.log available"
        exit 1
      }
      
      echo "Installing critical packages separately..."
      npm install cors express body-parser --save --loglevel=verbose || {
        echo "Failed to install critical packages"
        cat npm-debug.log || echo "No npm-debug.log available"
        exit 1
      }
      
      echo "Verifying installation..."
      ls -la node_modules | grep cors
      
      echo "Installation completed successfully"
    ignoreErrors: false 