option_settings:
  aws:elasticbeanstalk:application:environment:
    # Set environment variables for DocumentDB
    NODE_ENV: "production"

files:
  "/opt/elasticbeanstalk/hooks/appdeploy/pre/01_download_docdb_cert.sh":
    mode: "000755"
    owner: webapp
    group: webapp
    content: |
      #!/bin/bash
      # Download DocumentDB certificate to multiple locations to ensure it's found
      cd /var/app/staging
      echo "Downloading DocumentDB certificate to application directory..."
      wget -O global-bundle.pem https://truststore.pki.rds.amazonaws.com/global/global-bundle.pem
      
      # Also copy to system SSL certs directory
      echo "Copying certificate to system SSL directory..."
      sudo cp global-bundle.pem /etc/ssl/certs/
      
      # Set proper permissions
      sudo chmod 644 /etc/ssl/certs/global-bundle.pem
      sudo chmod 644 global-bundle.pem
      
      echo "Certificate download completed."
      
  "/opt/elasticbeanstalk/hooks/configdeploy/pre/01_download_docdb_cert.sh":
    mode: "000755"
    owner: webapp
    group: webapp
    content: |
      #!/bin/bash
      # Also run on configuration deployments
      cd /var/app/current
      echo "Downloading DocumentDB certificate to current application directory..."
      wget -O global-bundle.pem https://truststore.pki.rds.amazonaws.com/global/global-bundle.pem
      
      # Also copy to system SSL certs directory
      echo "Copying certificate to system SSL directory..."
      sudo cp global-bundle.pem /etc/ssl/certs/
      
      # Set proper permissions
      sudo chmod 644 /etc/ssl/certs/global-bundle.pem
      sudo chmod 644 global-bundle.pem
      
      echo "Certificate download completed." 